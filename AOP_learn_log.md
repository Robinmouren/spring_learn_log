### AOP总结 ——2023-12-25  16:20

**概念**：AOP(Aspect Oriented Porgramming) ***面向切面编程***，一种编程范式、**思想**

**作用**：在不惊动原始设计的基础上为方法进行**功能增强**

**核心概念**

* **代理**(Proxy)：SpringAOP的核心本质是采用代理模式实现的，目标对象无法直接完成工作，需要对其进行功能回填，通过原始对象的代理对象实现
* **连接点**(JoinPoint)：在SpringAOP中，理解为任意方法的执行
* **切入点**(Pointcut)：匹配连接点的狮子，也就是具有共性功能的方法描述，即**要追加功能的方法**
* **通知**(Advice)：若干个方法的共性功能，在切入点处执行，最终体现为一个方法，即**共性功能**
* **切面**(Aspect)：描述通知与切入点的对应关系
* **目标对象**(Target)：被代理的原始对象成为目标对象，**原始功能去掉共性功能对应的类产生的对象，这种对象是无法直接完成最终工作的**

******

**AOP工作流程**

1、Spring容器启动

2、**读取**所有切面配置中的切入点

3、初始化bean，判定bean对应的类中的方法是否**匹配**到任意切入点

* 匹配失败，创建对象
* 匹配成功，创建原始对象(**目标对象**)的**代理**对象

4、获取bean执行方法

* 获取bean，调用方法并执行，完成操作
* 获取的bean是代理对象时，根据代理对象的运行模式运行原始方法与增强的内容，完成操作

****

* **切入点表达式标准格式**：动作关键词（访问修饰符 返回值 包名.类/接口名.方法名（参数）异常名））
  * execution(* com.itheima.service.*Service.*(..))

* **切入点表达式描述通配符**：
  * *： 批评日任意符号
  * .. ：匹配福哦个连续的任意符号
  * +：匹配子类类型

**通知类型**

* **前置通知**
* **后置通知**
* **环绕通知**（***重点***）
  * 环绕通知依赖形参**ProceedingJoinPoint**才能实现对原始方法的调用
  * ————可以隔离原始方法的调用执行
  * ————返回值设置为**Object**类型
  * ————可以对原始方法调用过程中出现的异常进行处理
* **返回后通知**
* **抛出异常后通知**

*****

* **获取切入点方法的参数**
  * **JoinPoint** ：适用于前置、后置、返回后、抛出异常后通知，设置为方法的**第一个形参**
  * **ProceedJointPoint**：适用于环绕通知
    * pjp的getArgs方法获得**参数对象数组**
    * ProceedingJoinPoint类型的参数对象pjp中的proceed方法**可以传参**args，可以**修改**args中的数据以及参数**初始值**的设置等

* **获取切入点方法返回值**
  * 返回后通知
    * 注释中加上**returning**对应的值，并要与afterReturning方法参数中的**类型名**相同
  * **环绕通知**

* **获取切入点方法运行异常信息**
  * 抛出异常后通知
  * **环绕通知**